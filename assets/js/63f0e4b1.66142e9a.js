"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[2624],{62779:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"observability/real-user-monitoring-with-Faro","title":"Real User Monitoring with Faro","description":"Detecting loading times of pages and user behavior within their browsers can often be tricky, as there are no logs or metrics generated to inspect. Grafana Faro solves this by enabling you to add a JavaScript SDK to your frontend which sends events over HTTP to a receiver that ingests the data into Grafana. This way you are able to observe real user behavior metrics in real time using Grafana and set alerts on them as you usually would with Grafana Alerting.","source":"@site/docs/10-observability/08-real-user-monitoring-with-Faro.md","sourceDirName":"10-observability","slug":"/observability/real-user-monitoring-with-Faro","permalink":"/docs/observability/real-user-monitoring-with-Faro","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/10-observability/08-real-user-monitoring-with-Faro.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Grafana cheat sheet","permalink":"/docs/observability/grafana-cheat-sheet"},"next":{"title":"\ud83d\udcbe Lagring","permalink":"/docs/lagring/"}}');var r=n(74848),a=n(28453);const s={},o="Real User Monitoring with Faro",d={},l=[{value:"Getting started",id:"getting-started",level:2},{value:"Installing the SDK",id:"installing-the-sdk",level:3},{value:"Configuring the SDK",id:"configuring-the-sdk",level:3},{value:"List of valid options for <code>app</code>",id:"list-of-valid-options-for-app",level:3},{value:"Configuring the SDK with React Router integration",id:"configuring-the-sdk-with-react-router-integration",level:3},{value:"Showing the data",id:"showing-the-data",level:2},{value:"Privacy concerns",id:"privacy-concerns",level:2},{value:"Rate limiting",id:"rate-limiting",level:2},{value:"Tracing",id:"tracing",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"real-user-monitoring-with-faro",children:"Real User Monitoring with Faro"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:n(68574).A+"",width:"1712",height:"1036"})}),"\n",(0,r.jsxs)(t.p,{children:["Detecting loading times of pages and user behavior within their browsers can often be tricky, as there are no logs or metrics generated to inspect. ",(0,r.jsx)(t.a,{href:"https://grafana.com/oss/faro/",children:"Grafana Faro"})," solves this by enabling you to add a JavaScript SDK to your frontend which sends events over HTTP to a receiver that ingests the data into Grafana. This way you are able to observe real user behavior metrics in real time using Grafana and set alerts on them as you usually would with Grafana Alerting."]}),"\n",(0,r.jsx)(t.p,{children:"There are multiple types of events that are supported by Faro:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Events like Time To First Byte and First Contentful Paint can help with debugging slow frontend pages"}),"\n",(0,r.jsx)(t.li,{children:"Exceptions are collected and sent so that you have a complete catalogue of any exceptions that have been thrown in the frontend of your app. Source maps are used to map line numbers back to source code"}),"\n",(0,r.jsx)(t.li,{children:"Page visits are counted so that you can see which pages are visited by users."}),"\n",(0,r.jsx)(t.li,{children:"Metadata like browser type enables you to see which browsers are in use and which you don\u2019t need to support anymore"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["You may have heard of similar services like ",(0,r.jsx)(t.a,{href:"http://sentry.io/",children:"Sentry.io"})," . Faro is not to be confused with an analytics service,and it is recommended to have a separate instance for user insights like Google Analytics or Posthog. An analytics service can tell you more about user behaviour, while services like Faro and Sentry are more intended for monitoring and debugging."]}),"\n",(0,r.jsx)(t.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,r.jsx)(t.p,{children:"Setting up Faro requires two steps which are explained below:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Installing the SDK"}),"\n",(0,r.jsx)(t.li,{children:"Configuring the SDK"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["It will also be useful to start by reading the ",(0,r.jsx)(t.a,{href:"https://github.com/grafana/faro-web-sdk/blob/main/docs/sources/tutorials/quick-start-browser.md#install-grafana-faro-web-sdk",children:"Faro quick start guide"})," . See also the ",(0,r.jsx)(t.a,{href:"https://github.com/grafana/faro-web-sdk/blob/main/README.md",children:"README"})," of the Faro GitHub page for more links to relevant documentation."]}),"\n",(0,r.jsx)(t.h3,{id:"installing-the-sdk",children:"Installing the SDK"}),"\n",(0,r.jsx)(t.p,{children:"If you use React this is done by running one of the following commands:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# If you use npm\nnpm i -S @grafana/faro-web-sdk\n\n# If you use Yarn\nyarn add @grafana/faro-web-sdk\n"})}),"\n",(0,r.jsx)(t.h3,{id:"configuring-the-sdk",children:"Configuring the SDK"}),"\n",(0,r.jsx)(t.p,{children:"Import and configure the following options in your app\u2019s entrypoint (main.js or similar)."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:'import { initializeFaro } from "@grafana/faro-react";\n\ninitializeFaro({\n  app: {\n    name: "my_app_name",\n    environment: getCurrentEnvironment(),\n  },\n  url: "https://faro.atgcp1-prod.kartverket.cloud/collect",\n});\n'})}),"\n",(0,r.jsxs)(t.h3,{id:"list-of-valid-options-for-app",children:["List of valid options for ",(0,r.jsx)(t.code,{children:"app"})]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{}),(0,r.jsx)(t.th,{children:(0,r.jsx)(t.strong,{children:"Type"})}),(0,r.jsx)(t.th,{children:(0,r.jsx)(t.strong,{children:"Description"})}),(0,r.jsx)(t.th,{children:(0,r.jsx)(t.strong,{children:"Required?"})})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"name"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:"The name of the application as it will appear on dashboards in Grafana"}),(0,r.jsx)(t.td,{children:"Yes"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"environment"}),(0,r.jsx)(t.td,{children:"\u201clocalhost\u201d | \u201cdev\u201d | \u201ctest\u201d | \u201cprod\u201d"}),(0,r.jsx)(t.td,{children:"The environment the frontend is currently running in. This is used to filter data in Grafana dashboards"}),(0,r.jsx)(t.td,{children:"Yes"})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"configuring-the-sdk-with-react-router-integration",children:"Configuring the SDK with React Router integration"}),"\n",(0,r.jsxs)(t.p,{children:["Grafana Faro supports integration with React Router. This gives you events for page navigation and re-renders. See the ",(0,r.jsx)(t.a,{href:"https://github.com/grafana/faro-web-sdk/blob/main/packages/react/README.md",children:"Faro docs"})," for more information on this."]}),"\n",(0,r.jsx)(t.h2,{id:"showing-the-data",children:"Showing the data"}),"\n",(0,r.jsxs)(t.p,{children:["When the metrics have started to be gathered, they will be visible in a dedicated Grafana Faro dashboard. This dashboard can be found ",(0,r.jsx)(t.a,{href:"https://monitoring.kartverket.cloud/d/CiroMopVz/grafana-faro-frontend-monitoring",children:"here"})," ."]}),"\n",(0,r.jsxs)(t.p,{children:["It is also possible to search for data in the ",(0,r.jsx)(t.a,{href:"https://monitoring.kartverket.cloud/explore",children:"explore view"})," . Useful labels to search for are:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"faro_app_name"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"kind"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"env"})}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"privacy-concerns",children:"Privacy concerns"}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsx)(t.p,{children:"It is up to you and your team to consider the how to use Faro with personal information as outlined in your IP and DPIA"})}),"\n",(0,r.jsxs)(t.p,{children:["When we send data to Faro, it is mostly metrics that don\u2019t contain any ",(0,r.jsx)(t.a,{href:"https://www.investopedia.com/terms/p/personally-identifiable-information-pii.asp",children:"PII"})," . It is possible to include PII like name, IP or anything that is accessible from JavaScript in the SDK, but this is not done by default and requres calling the ",(0,r.jsx)(t.code,{children:"setUser"})," function on the SDK."]}),"\n",(0,r.jsxs)(t.p,{children:["A session ID is sent in to enable de-duplicating events like navigation between pages and ranking top users. This is a randomly generated string and is stored in the user\u2019s browser SessionStorage. Note that even though this is not a cookie, this means a \u201ccookie banner\u201d is required as per the EU\u2019s ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/EPrivacy_Directive#Cookies",children:"ePrivacy directive"})," ."]}),"\n",(0,r.jsxs)(t.p,{children:["As ",(0,r.jsx)(t.code,{children:"SessionInstrumentation"})," is ",(0,r.jsx)(t.a,{href:"https://github.com/grafana/faro-web-sdk/blob/28f2d0c6c3032ce56876045c5a92256f5f798605/packages/web-sdk/src/config/getWebInstrumentations.ts#L18",children:"included by default"})," in the web instrumentation of the JavaScript SDK, disabling it requires invoking the SDK with ",(0,r.jsx)(t.code,{children:"instrumentations"})," set and omitting the ",(0,r.jsx)(t.code,{children:"SessionInstrumentation"})," function."]}),"\n",(0,r.jsxs)(t.p,{children:["Data is stored on SKIP\u2019s ",(0,r.jsx)(t.code,{children:"atgcp1-prod"})," cluster, which stores data in Google Cloud Storage europe-north1 region. This region is located in Finland, and is thus within EU. This means no data leaves the EU\u2019s borders which means the storage of the data is compliant with GDPR."]}),"\n",(0,r.jsx)(t.h2,{id:"rate-limiting",children:"Rate limiting"}),"\n",(0,r.jsxs)(t.p,{children:["A rate limit for requests is implemented and is currently set to ",(0,r.jsx)(t.code,{children:"50"})," requests per second. This is shared between all users of Faro, so it\u2019s possible that we eventually reach the limit. Contact SKIP if you start getting queries rejected with ",(0,r.jsx)(t.code,{children:"HTTP 429 Too Many Requests"})," ."]}),"\n",(0,r.jsx)(t.p,{children:"The rate limiting algorighm is a token bucket algorithm, where a bucket has a maximum capacity for up to burst_size requests and refills at a rate of rate per second."}),"\n",(0,r.jsx)(t.p,{children:"Each HTTP request drains the capacity of the bucket by one. Once the bucket is empty, HTTP requests are rejected with an HTTP 429 Too Many Requests status code until the bucket has more available capacity."}),"\n",(0,r.jsx)(t.h2,{id:"tracing",children:"Tracing"}),"\n",(0,r.jsxs)(t.p,{children:["Faro supports ",(0,r.jsx)(t.a,{href:"https://grafana.com/docs/grafana-cloud/monitor-applications/frontend-observability/instrument/tracing-instrumentation/",children:"tracing"})," of HTTP requests, but this is not currently implemented in the collector on SKIP. Contact SKIP if you want this!"]})]})}function c(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},68574:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/faro_header-fd5b34cabe5f5dc538f62b5ea580d18e.png"},28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>o});var i=n(96540);const r={},a=i.createContext(r);function s(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);