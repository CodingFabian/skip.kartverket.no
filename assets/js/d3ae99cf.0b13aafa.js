"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[2236],{96888:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var s=a(85893),n=a(11151);const r={},o="Grafana cheat sheet",i={id:"observability/grafana-cheat-sheet",title:"Grafana cheat sheet",description:"This is a collection of tips&tricks that are useful when troubleshooting problems in the kubernetes clusters based on data from LGTM",source:"@site/docs/10-observability/07-grafana-cheat-sheet.md",sourceDirName:"10-observability",slug:"/observability/grafana-cheat-sheet",permalink:"/docs/observability/grafana-cheat-sheet",draft:!1,unlisted:!1,editUrl:"https://github.com/kartverket/skip-docs/edit/main/docs/10-observability/07-grafana-cheat-sheet.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Recording and alerting rules",permalink:"/docs/observability/recording-and-alerting-rules"},next:{title:"Real User Monitoring with Faro",permalink:"/docs/observability/real-user-monitoring-with-Faro"}},c={},l=[{value:"Useful Mimir queries",id:"useful-mimir-queries",level:2},{value:"Top 20 of metrics with high cardinality",id:"top-20-of-metrics-with-high-cardinality",level:3},{value:"Top 10 namespaces with overallocated cpu resources",id:"top-10-namespaces-with-overallocated-cpu-resources",level:3},{value:"Sum of overallocated cpu for containers by namespace",id:"sum-of-overallocated-cpu-for-containers-by-namespace",level:3},{value:"Daily amount of requests by destination app and response code",id:"daily-amount-of-requests-by-destination-app-and-response-code",level:3}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,n.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"grafana-cheat-sheet",children:"Grafana cheat sheet"}),"\n",(0,s.jsx)(t.p,{children:"This is a collection of tips&tricks that are useful when troubleshooting problems in the kubernetes clusters based on data from LGTM"}),"\n",(0,s.jsx)(t.h2,{id:"useful-mimir-queries",children:"Useful Mimir queries"}),"\n",(0,s.jsx)(t.h3,{id:"top-20-of-metrics-with-high-cardinality",children:"Top 20 of metrics with high cardinality"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://monitoring.kartverket.dev/goto/cc_GwW1SR?orgId=1",children:"https://monitoring.kartverket.dev/goto/cc_GwW1SR?orgId=1"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",children:'# Set time range to "Last 5 minutes"\ntopk(20, count by (__name__)({__name__=~".+"}))\n'})}),"\n",(0,s.jsx)(t.h3,{id:"top-10-namespaces-with-overallocated-cpu-resources",children:"Top 10 namespaces with overallocated cpu resources"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://monitoring.kartverket.dev/goto/6V2jQZJIg?orgId=1",children:"https://monitoring.kartverket.dev/goto/6V2jQZJIg?orgId=1"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",children:'topk(10, sum by (namespace)\n  (kube_pod_container_resource_requests{job="integrations/kubernetes/kube-state-metrics", resource="cpu"})\n  - sum by (namespace) (rate(container_cpu_usage_seconds_total{}[$__rate_interval])))\n'})}),"\n",(0,s.jsx)(t.h3,{id:"sum-of-overallocated-cpu-for-containers-by-namespace",children:"Sum of overallocated cpu for containers by namespace"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://monitoring.kartverket.dev/goto/xF2DlW1SR?orgId=1",children:"https://monitoring.kartverket.dev/goto/xF2DlW1SR?orgId=1"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",children:'sum by (container)\n  (kube_pod_container_resource_requests{job="integrations/kubernetes/kube-state-metrics", resource="cpu", namespace=~"matrikkel.*"})\n  - sum by (container) (rate(container_cpu_usage_seconds_total{namespace=~"matrikkel.*"}[$__rate_interval]))\n'})}),"\n",(0,s.jsx)(t.h3,{id:"daily-amount-of-requests-by-destination-app-and-response-code",children:"Daily amount of requests by destination app and response code"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",children:'sum by (destination_app, response_code) (\n  increase(istio_requests_total{namespace="<namespace name>", response_code=~".*", source_app="istio-ingress-external"}[1d])\n)\n'})}),"\n",(0,s.jsx)(t.h1,{id:"useful-loki-queries",children:"Useful Loki queries"})]})}function u(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,t,a)=>{a.d(t,{Z:()=>i,a:()=>o});var s=a(67294);const n={},r=s.createContext(n);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);