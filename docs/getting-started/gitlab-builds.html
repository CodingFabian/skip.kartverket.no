<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SKIP Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SKIP Blog Atom Feed"><title data-react-helmet="true">GitLab-byggeløyper | SKIP</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://kartverket.github.io/docs/getting-started/gitlab-builds"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="GitLab-byggeløyper | SKIP"><meta data-react-helmet="true" name="description" content="Generelt"><meta data-react-helmet="true" property="og:description" content="Generelt"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kartverket.github.io/docs/getting-started/gitlab-builds"><link data-react-helmet="true" rel="alternate" href="https://kartverket.github.io/docs/getting-started/gitlab-builds" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://kartverket.github.io/docs/getting-started/gitlab-builds" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.c1af1c4a.css">
<link rel="preload" href="/assets/js/runtime~main.4e56ff22.js" as="script">
<link rel="preload" href="/assets/js/main.a0950d9e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/skip.png" alt="SKIP" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/skip.png" alt="SKIP" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">SKIP</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://confluence.statkart.no/display/SKIP" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Confluence<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://gitlab.statkart.no/skip" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://gitlab.statkart.no/skip/issues/-/issues/new?issue#" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Registrer sak<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/intro">Introduksjon</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Kom i gang!</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/deploy-to-kubernetes">Deploye til Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/gitlab-builds">GitLab-byggeløyper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/basic-botkube-commands">Grunnleggende BotKube-kommandoer</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/groups-and-projects-in-gitlab">Grupper og prosjekter i GitLab</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/kubernetes-manifests">Kubernetes manifestfiler</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/login-and-access-to-cluster">Login og tilgang til cluster miljøer</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/harbor">Oppsett og bruk av Harbor</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/vault">Oppsett og bruk av Vault</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/helm">Bruk av Helm</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/roadmap">Roadmap</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>GitLab-byggeløyper</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="generelt"></a>Generelt<a class="hash-link" href="#generelt" title="Direct link to heading">#</a></h2><p>GitLab-byggeløyper opprettes ved å legge til en fil med navn .gitlab-ci.yml (NB!
merk innledende punktum) i prosjektets rotkatalog.</p><p>Dokumentasjon av syntaksen man bruker finnes her: <a href="https://docs.gitlab.com/ee/ci/" target="_blank" rel="noopener noreferrer">https://docs.gitlab.com/ee/ci/</a></p><p>Denne siden tar for seg en migrasjonsprosess fra Jenkins-byggeløyper og over
i GitLab.</p><p>I motsetning til Jenkins er det bare 1 pipeline-fil per prosjekt. Denne filen
inneholder definisjon på alle jobber som skal kjøres i prosjektet når en fil
sjekkes inn. Individuelle jobber kan settes opp til å kun kjøres under gitte
omstendigheter, til gitte tider, osv.</p><p>Hver pipeline deles inn i &quot;Stages&quot; og &quot;Jobs&quot;. Hvert stage kan inneholde 1 eller
flere jobber, men hver jobb kan bare inngå i 1 stage. Stages er blant annet
nyttig for å holde styr på parallellisering og sekvensielle jobber - alle jobber
i en gitt stage kjører parallellt, så dersom man er avhengig av et sekvensielt
byggforløp (eks. build → test → publish → deploy), vil man typisk dele disse opp
i 4 stages som kjøres sekvensielt - men f.eks. test-stage kan parallelliseres
dersom man har flere ulike testjobber, slik som sikkerhetsscanning, statisk
analyse osv.</p><p>Rekkefølgen på stages (og eventuelle ekstra stages utover de som GitLab har
definert som standard - build, test, deploy) defineres slik i begynnelsen av
pipelinescriptet:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">stages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> publish</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="variabler"></a>Variabler<a class="hash-link" href="#variabler" title="Direct link to heading">#</a></h3><p>Variabler(eksempelvis brukernavn/token til Harbor-registry, http proxy etc.) kan
settes som CI/CD-variabler, enten på prosjektnivå eller gruppenivå. Variabler på
gruppenivå vil da være tilgjengelige for alle prosjekter i gruppen.</p><p>Variabler kan også gjøres tilgjengelig for hele GitLab-instansen av
administratorer dersom dette skulle være aktuelt.</p><p>Variabler kan settes opp til å maskeres i output, og også settes opp til å kun
deles med &quot;protected&quot; branches dersom dette er ønskelig.</p><p>For å legge til en variabel, klikk &quot;Settings&quot; i menyen til høyre
i GitLab-prosjektet eller gruppen du ønsker, og velg &quot;CI/CD&quot;. Trykk så på
&quot;Expand&quot; under Variables-seksjonen, og klikk på &quot;Add Variable&quot;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="mellomlagring-caching-og-artefakter"></a>Mellomlagring, caching og artefakter<a class="hash-link" href="#mellomlagring-caching-og-artefakter" title="Direct link to heading">#</a></h3><p>Man kan få byggeforløpet til å gå raskere ved å gjenbruke pakker, artefakter
etc. på tvers av jobber.</p><p>Dette kan oppnås ved hjelp av bruk av nøkkelordene &quot;cache&quot; og &quot;artifacts&quot;.</p><p>Cache kan brukes for dependencies som lastes ned fra nettet - pakker,
biblioteker og den slags.</p><p>Artifacts kan brukes for å videresende midlertidige byggeartefakter (eks.
jar-filer) mellom stages.</p><p>Artifacts kan også tilgjengeliggjøres i etterkant dersom det er hensiktsmessing,
eksempelvis testrapporter som man jo ønsker å kunne lese i etterkant av en
fullført pipeline.</p><p>Les mer om forskjellen på bruk av cache og artifacts, samt utvidet dokumentasjon
her:</p><p><a href="https://docs.gitlab.com/ee/ci/caching/" target="_blank" rel="noopener noreferrer">https://docs.gitlab.com/ee/ci/caching/</a></p><p><a href="https://docs.gitlab.com/ee/ci/pipelines/job_artifacts.html" target="_blank" rel="noopener noreferrer">https://docs.gitlab.com/ee/ci/pipelines/job_artifacts.html</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="images"></a>Images<a class="hash-link" href="#images" title="Direct link to heading">#</a></h3><p>GitLab bruker &quot;runnere&quot; for å kjøre bygg. Disse tilsvarer Jenkins-byggenoder,
med en viktig forskjell: de spinnes opp i Kubernetes hver gang et bygg starter,
og har ingenting forhåndsinstallert.</p><p>Nøkkelordet &quot;image:&quot; brukes for å definere hva som skal være tilgjengelig i en
slik runner - dette er rett og slett docker-imaget man vil at runneren skal
startes med.</p><p>Trenger man Gradle, npm osv. kan dette altså løses ved å bruke et image med
dette forhåndsinstallert.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="templates"></a>Templates<a class="hash-link" href="#templates" title="Direct link to heading">#</a></h3><p>Templates er forhåndsdefinerte jobber/stages m.m. som man kan importere inn
i pipelinescriptet sitt ved hjelp av et include-nøkkelord i begynnelsen av fila.</p><p>Eksemplevis vil et template kalt SAST.gitlab-ci.yml være noe vi ønsker de fleste
pipelines tar med, det gjennomfører bl.a. statisk sikkerhetstesting og scanning
av kode.</p><p>Man kan lage sine egne templates for å samle felles funksjonalitet som flere
pipelines brukes på samme sted, se
<a href="https://docs.gitlab.com/ee/development/cicd/templates.html" target="_blank" rel="noopener noreferrer">https://docs.gitlab.com/ee/development/cicd/templates.html</a> for artikler knyttet
til utvikling av egne templates.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Obs! Ved bruk av SAST-template må du sørge for følgende:</h5></div><div class="admonition-content"><ul><li>Ved bruk av gradle-wrapper må den være merket som eksekverbar. Kjør kommandoen
git update-index --chmod=+x gradlew , commit og push.</li><li>Dersom prosjektet benytter en annen java-versjon enn 8, må det settes en CI/CD
variabel på prosjekt-eller gruppenivå kalt SAST_JAVA_VERSION med verdi lik
java-versjonen man bruker (eks. 11 hvis man bruker java 11).</li></ul></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="byggingtesting"></a>Bygging/testing<a class="hash-link" href="#byggingtesting" title="Direct link to heading">#</a></h2><p>Byggesteg foregår ved hjelp av en eller flere bash-kommandoer under nøkkelordet
&quot;script&quot;.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Dette er et enkelt byggescript&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gradle assemble</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>GitLabs standard er at bygging og testing foregår i separate jobber - dette er
imidlertid retningslinjer, ikke tvang, så det kan tilpasses ut fra egne behov.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="publisering"></a>Publisering<a class="hash-link" href="#publisering" title="Direct link to heading">#</a></h2><p>Publisering av Docker-images skal skje ved hjelp av Kaniko buildpack, dette for
å unngå Docker-in-Docker på GitLab-runnere med medfølgende privilegerte
containere, som er en potensiell sikkerhetsrisiko.</p><p>For å publisere et Docker-image til Harbor (vårt foretrukne container-registry)
må man ha opprettet et prosjekt og en robot-bruker for prosjektet man kan logge
seg inn med (se egen dokumentasjon for dette her).</p><p>Robot-brukernavn og token legges så inn som CI-variabler på gruppenivå som
beskrevet ovenfor i seksjonen om variabler. I eksempelet har vi brukt
HARBOR_USERNAME og HARBOR_TOKEN som navn på disse.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">publish</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> publish</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/kaniko</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">project/executor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">debug</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">entrypoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mkdir </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">p /kaniko/.docker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      KANIKOPROXYBUILDARGS=&quot;&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      KANIKOCFG=&quot;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> \&quot;auths\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">\&quot;$HARBOR_URL\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">\&quot;username\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">\&quot;$HARBOR_USERNAME\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\&quot;password\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">\&quot;$HARBOR_TOKEN\&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      if </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> &quot;x$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">http_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot; </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &quot;x&quot; </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">o &quot;x$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">https_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot; </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &quot;x&quot; </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">; then</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        KANIKOCFG=&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">KANIKOCFG</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;proxies\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;default\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;httpProxy\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> \&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">http_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;httpsProxy\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> \&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">https_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;noProxy\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> \&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">no_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">\&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        KANIKOPROXYBUILDARGS=&quot;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">arg http_proxy=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">http_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">arg https_proxy=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">https_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">arg no_proxy=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">no_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      fi</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      KANIKOCFG=&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">KANIKOCFG</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      echo &quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">KANIKOCFG</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> /kaniko/.docker/config.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cat /kaniko/.docker/config.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /kaniko/executor </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">context $CI_PROJECT_DIR </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dockerfile $CI_PROJECT_DIR/Dockerfile $KANIKOPROXYBUILDARGS </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">destination harbor.statkart.no/example/gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$CI_COMMIT_TAG</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">only</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">refs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> master</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">except</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tags</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="release"></a>Release<a class="hash-link" href="#release" title="Direct link to heading">#</a></h2><p>GitLab har et konsept i forhold til kode som kalles &quot;release&quot;. Dette er et
snapshot av all kode og andre relevante artefakter slik det så ut ved tidspunkte
releasen ble opprettet. Den kan tenkes på som en slags git tag med utvidede
muligheter for å inkludere dokumentasjon osv.</p><p>Les mer her: <a href="https://docs.gitlab.com/ee/user/project/releases/" target="_blank" rel="noopener noreferrer">https://docs.gitlab.com/ee/user/project/releases/</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="komplett-løype"></a>Komplett løype<a class="hash-link" href="#komplett-løype" title="Direct link to heading">#</a></h2><p>Eksempel på en komplett pipeline som bygger, tester, publiserer og lager en
release:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">include</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Security/SAST.gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ci.yml </span><span class="token comment" style="color:#999988;font-style:italic"># for å få med automatiske jobber for sikkerhetskontroll av kode osv.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Definer alle jobber som må kjøre sekvensielt her, ellers blir de kjørt i parallell</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">stages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> publish</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> release</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">FF_GITLAB_REGISTRY_HELPER_IMAGE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gradle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">jdk11</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">GRADLE_OPTS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-Dorg.gradle.daemon=false&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">before_script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> export GRADLE_USER_HOME=`pwd`/.gradle</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gradle assemble</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;PROJECT_VERSION=$MAJOR_VERSION.$MINOR_VERSION.$CI_JOB_ID&quot; </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> build.env </span><span class="token comment" style="color:#999988;font-style:italic"># bruk build-jobbens unike id som utgangspunkt for patch-delen av semver-versjonstagg</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;$CI_COMMIT_REF_NAME&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># cache artefaktet som er bygd slik at vi kan bruke det til å kjøre tester og eventuelt pakke inn i docker-image</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">policy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> push</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .gradle/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">reports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">dotenv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build.env </span><span class="token comment" style="color:#999988;font-style:italic"># dette er for å kunne dele variabler mellom byggejobber, i dette tilfellet versjonsnummer</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">except</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tags </span><span class="token comment" style="color:#999988;font-style:italic"># ikke kjør denne jobben når man sjekker inn en tag</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gradle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">jdk11</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">GRADLE_OPTS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-Dorg.gradle.daemon=false&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">before_script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> export GRADLE_USER_HOME=`pwd`/.gradle</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;This is where the testing is done&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gradle test </span><span class="token comment" style="color:#999988;font-style:italic"># eksempel-templaten bruker check istedenfor test, kan evt vurdere hva dette har å si</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;$CI_COMMIT_REF_NAME&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># hent ferdigbygd artefakt fra cache</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">policy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pull</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .gradle/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">reports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">junit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build/test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">results/test/</span><span class="token important">**/TEST-*.xml</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#riktig filsti til testrapporten er viktig</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">except</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tags</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">publish</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> publish</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/kaniko</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">project/executor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">debug</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">entrypoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mkdir </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">p /kaniko/.docker</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      KANIKOPROXYBUILDARGS=&quot;&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      KANIKOCFG=&quot;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> \&quot;auths\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">\&quot;$HARBOR_URL\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">\&quot;username\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">\&quot;$HARBOR_USERNAME\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\&quot;password\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">\&quot;$HARBOR_TOKEN\&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      if </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> &quot;x$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">http_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot; </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &quot;x&quot; </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">o &quot;x$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">https_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot; </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &quot;x&quot; </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">; then</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        KANIKOCFG=&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">KANIKOCFG</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;proxies\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;default\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;httpProxy\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> \&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">http_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;httpsProxy\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> \&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">https_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">\&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">\&quot;noProxy\&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> \&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">no_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">\&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        KANIKOPROXYBUILDARGS=&quot;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">arg http_proxy=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">http_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">arg https_proxy=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">https_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">arg no_proxy=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">no_proxy</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      fi</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      KANIKOCFG=&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">KANIKOCFG</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      echo &quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">KANIKOCFG</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> /kaniko/.docker/config.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cat /kaniko/.docker/config.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /kaniko/executor </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">context $CI_PROJECT_DIR </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dockerfile $CI_PROJECT_DIR/Dockerfile $KANIKOPROXYBUILDARGS </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">destination harbor.statkart.no/example/gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$CI_COMMIT_TAG</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">only</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">refs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> master</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">except</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tags</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Lager en release som samler &quot;evidence&quot; (kildekode etc) på ett sted og sjekker inn en git tag i koderepoet</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.gitlab.com/gitlab</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">org/release</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cli</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Release stage&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo $PROJECT_VERSION</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">release</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tag_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $PROJECT_VERSION</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Gitlab demo&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">only</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">refs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> master</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">except</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tags</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kartverket/skip-docs/edit/main/docs/getting-started/gitlab-builds.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/getting-started/deploy-to-kubernetes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Deploye til Kubernetes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/getting-started/basic-botkube-commands"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Grunnleggende BotKube-kommandoer »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#generelt" class="table-of-contents__link">Generelt</a><ul><li><a href="#variabler" class="table-of-contents__link">Variabler</a></li><li><a href="#mellomlagring-caching-og-artefakter" class="table-of-contents__link">Mellomlagring, caching og artefakter</a></li><li><a href="#images" class="table-of-contents__link">Images</a></li><li><a href="#templates" class="table-of-contents__link">Templates</a></li></ul></li><li><a href="#byggingtesting" class="table-of-contents__link">Bygging/testing</a></li><li><a href="#publisering" class="table-of-contents__link">Publisering</a></li><li><a href="#release" class="table-of-contents__link">Release</a></li><li><a href="#komplett-løype" class="table-of-contents__link">Komplett løype</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/docs/intro">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/docs/roadmap">Roadmap</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://gitlab.statkart.no/skip" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Statens Kartverk. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4e56ff22.js"></script>
<script src="/assets/js/main.a0950d9e.js"></script>
</body>
</html>